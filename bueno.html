<!DOCTYPE html>
<html>
<head>
  <title>Recetario BRIXTON</title>
  <link rel="stylesheet" type="text/css" href="./static/styles2.css">
</head>
<body>
  <div class="container">
    <div class="centered-wrapper"></div>
    <div class="barra-superior"></div>
    <div class="rectangle-name">
      <output class="text-output-dos" id="query-output"></output> 
    </div> 
    <div class="rectangle-class">
      <output class="text-output-dos" id="classification-output"></output> 
    </div> 
    <div class="back-button">
      <a href="index.html" class="back-link button"></a>
    </div>   
    <div class="rectangle">
      <output class="text-output" id="ingredients-output"></output>
    </div>
    <div class="rectangle-other">
      <output class="text-output" id="preparation-output"></output>
    </div>
    <div class="rectangle-img">
      <img src="" alt="Imagen del trago" class="foto" id="drink-image">
    </div>    
  </div>

  <script>
  function titleCase(string) {
    return string
      .toLowerCase()
      .split(' ')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');
  }

  function searchRecipe(query, selection) {
    const cleanedQuery = query.replace(/\s+/g, ' ').trim();
    const trago = titleCase(cleanedQuery);
    let ingredientes = '';
    let preparacion = '';
    let clasificacion = '';

    fetch('./recetas.json')
      .then(response => response.json())
      .then(data => {
        const recipes = data.recetas;

        for (let i = 0; i < recipes.length; i++) {
          const recipe = recipes[i];
          if (recipe.nombre === trago) {
            ingredientes = recipe.ingredientes.join('<br>');
            preparacion = recipe.preparacion.join('<br>');
            clasificacion = recipe.clasificacion.join('<br>');
            break;
          }
        }

        if (ingredientes) {
          const image_path = `./images/${encodeURIComponent(cleanedQuery.toLowerCase().replace(/\s/g, ""))}.png`;
          document.getElementById('query-output').textContent = trago;
          document.getElementById('classification-output').textContent = clasificacion;

          if (selection === 'bartender') {
            // Mostrar ingredientes como clave: valor
            const ingredientesDict = recipe.ingredientes.reduce((acc, ingrediente) => {
              const [clave, valor] = ingrediente.split(': ');
              acc[clave] = valor;
              return acc;
            }, {});
            ingredientes = Object.entries(ingredientesDict).map(([clave, valor]) => `${clave}: ${valor}`).join('<br>');

            // Mostrar la sección de preparación en lugar de sugerencia
            document.getElementById('ingredients-output').innerHTML = ingredientes;
            document.getElementById('preparation-output').innerHTML = preparacion;
          } else {
            // Mostrar ingredientes normalmente y sugerencia en lugar de preparación
            document.getElementById('ingredients-output').innerHTML = ingredientes;
            document.getElementById('preparation-output').innerHTML = recipe.sugerencia.join('<br>');
          }

          document.getElementById('drink-image').src = image_path;
        } else {
          // Redirigir a la página de error y pasar el query como parámetro
          window.location.href = `error.html?query=${encodeURIComponent(query)}`;
        }
      })
      .catch(error => {
        // Redirigir a la página de error y pasar el query como parámetro
        window.location.href = `error.html?query=${encodeURIComponent(query)}`;
      });
  }

  const urlParams = new URLSearchParams(window.location.search);
  const query = urlParams.get('query');
  const selection = localStorage.getItem('selection'); 

  if (query && selection) {
    searchRecipe(query, selection);
  }

  </script>
</body>
</html>

